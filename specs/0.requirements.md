# Requirements for aki-mline

This document outlines the functional and non-functional requirements for the `aki-mline` command-line utility, derived from its source code.

## 1. High-Level Purpose

`aki-mline` is a command-line text filter that reads from standard input, matches lines against specified patterns (either regular expressions or simple strings), and writes the results to standard output. It is analogous to a simplified `grep`.

## 2. Functional Requirements

### 2.1. Core Functionality

- **FR1.1: Input Source:** The application MUST read text line-by-line from standard input.
- **FR1.2: Output Destination:** The application MUST write processed output to standard output.
- **FR1.3: Error Handling:** The application MUST write error messages to standard error.

### 2.2. Matching and Filtering

- **FR2.1: Regex Matching:** The application MUST support filtering lines using one or more regular expression patterns.
  - This is configured via the `-e <exp>` or `--exp <exp>` options.
- **FR2.2: Simple String Matching:** The application MUST support filtering lines using one or more simple string patterns.
  - This is configured via the `-s <string>` or `--str <string>` options.
- **FR2.3: Mandatory Pattern:** The application MUST require at least one regex (`-e`) or simple string (`-s`) option to be provided.
- **FR2.4: Inverse Matching:** The application MUST support inverting the filter to output lines that do *not* match any of the given patterns.
  - This is configured via the `-i` or `--inverse` flag.

### 2.3. Output Formatting

- **FR3.1: Color Highlighting:** The application MUST be able to highlight the exact matching substrings within the output lines.
  - This is controlled by the `--color <when>` option.
- **FR3.2: Color-When Modes:** The `<when>` parameter for the `--color` option MUST accept three values:
  - `always`: Always apply color highlighting.
  - `never`: Never apply color highlighting.
  - `auto`: Apply color highlighting only when standard output is connected to a terminal (TTY). This is the default behavior if the `--color` option is provided without a value or if the logic defaults to it.
- **FR3.3: Custom Color Sequences:** The ANSI escape codes used for color highlighting MUST be customizable via environment variables:
  - `AKI_MLINE_COLOR_SEQ_ST`: Defines the start sequence for the highlight (e.g., `\e[1;31m`).
  - `AKI_MLINE_COLOR_SEQ_ED`: Defines the end sequence for the highlight (e.g., `\e[0m`).

### 2.4. Command-Line Interface (CLI)

- **FR4.1: Help Information:** The application MUST display a help message and exit when the `-H` or `--help` flag is used.
- **FR4.2: Version Information:** The application MUST display its version information and exit when the `-V` or `--version` flag is used.
- **FR4.3: Argument Parsing:** The application must parse arguments in a standard GNU style. Unrecognized arguments should result in an error.
- **FR4.4: Special `-X` Options:** The application must support special, less-common options under the `-X` flag (e.g., `-X rust-version-info`).

## 3. Non-Functional Requirements

- **NFR1: Language:** The application MUST be implemented in Rust.
- **NFR2: Performance:** The application should be efficient in terms of memory and processing speed to handle large streams of input text.
- **NFR3: Error Reporting:** In case of invalid arguments or usage, the application MUST provide a clear error message and suggest using the `--help` flag for more information.
- **NFR4: Graceful Exit:** The application MUST handle `BrokenPipe` errors gracefully (e.g., when the output is piped to a command like `head` that closes the pipe early), exiting without an error message in this specific case.
